<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="./img/logo.png">
    <link rel="apple-touch-icon" href="./img/logo.png">
    <title>CV Stats - Pro Mode</title>
    <script src="./libs/tailwind.js"></script>
    <script src="./libs/charts.js"></script>
    <style>
        :root { --b: #0056FF; }
        body { 
            font-family: 'Inter', system-ui, sans-serif; 
            -webkit-user-select: none; user-select: none; 
            background: #F3F4F6;
        }
        .card { 
            background: #fff; 
            border-radius: 1.5rem; 
            box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .toast { 
            position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%); 
            background: #1f2937; color: #fff; padding: 1rem 2rem; 
            border-radius: 1rem; opacity: 0; transition: opacity 0.3s; 
            z-index: 9999;
        }
        .v { opacity: 1; }
        .app-input {
            background: #fff;
            border: 2px solid #E5E7EB;
            padding: 0.8rem;
            border-radius: 1rem;
            transition: all 0.2s;
            font-weight: 600;
        }
        .app-input:focus { border-color: var(--b); ring: 2px; }
        .btn-intense { transition: all 0.2s; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        .btn-intense:active { transform: scale(0.96); filter: brightness(0.9); }
    </style>
</head>
<body class="p-4 pb-12 text-gray-800" oncontextmenu="return false">

    <main class="max-w-md mx-auto space-y-6">
        <header class="flex justify-between items-center py-2">
            <div>
                <h1 class="text-2xl font-black italic tracking-tighter text-gray-900">CONTROL <span class="text-blue-600">VOLEY</span></h1>
                <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest">Estadísticas Pro</p>
            </div>
            <button onclick="if(confirm('¿Salir?')) window.close()" class="bg-red-600 text-white px-5 py-2 rounded-2xl text-xs font-black shadow-lg">SALIR</button>
        </header>

        <div class="card p-6">
            <h2 class="text-xs font-black uppercase tracking-widest text-blue-700 mb-4 flex items-center gap-2">
                <span class="w-2 h-2 bg-blue-600 rounded-full"></span> Nuevo Atleta
            </h2>
            <div class="flex gap-2">
                <input id="pN" placeholder="N°" class="w-16 app-input text-center" type="number">
                <input id="pM" placeholder="Nombre" class="flex-grow app-input" type="text">
                <button id="add" class="btn-intense bg-blue-600 text-white px-6 rounded-2xl font-black text-xl">+</button>
            </div>
        </div>

        <div class="card p-6 border-t-4 border-blue-600">
            <h2 class="text-xs font-black uppercase tracking-widest text-blue-700 mb-4">Registrar Jugada</h2>
            <form id="f" class="space-y-4">
                <select id="ps" class="w-full app-input text-gray-900"></select>
                <select id="as" class="w-full app-input text-sm text-gray-700"></select>
                <button class="btn-intense w-full bg-blue-600 text-white py-5 rounded-2xl font-black uppercase tracking-widest shadow-xl shadow-blue-200">
                    Registrar Acción
                </button>
                
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <button type="button" id="rs" class="btn-intense bg-amber-500 text-white py-4 rounded-2xl text-xs font-black uppercase shadow-lg shadow-amber-100">
                        Limpiar Set
                    </button>
                    <button type="button" id="ra" class="btn-intense bg-red-600 text-white py-4 rounded-2xl text-xs font-black uppercase shadow-lg shadow-red-100">
                        Borrar Todo
                    </button>
                </div>
            </form>
        </div>

        <div class="card p-6">
            <h2 class="text-xs font-black uppercase tracking-widest text-blue-700 mb-4">Resumen de Atletas</h2>
            <div id="st" class="space-y-3 max-h-72 overflow-y-auto"></div>
        </div>

        <div class="card p-4 h-72">
            <canvas id="c1"></canvas>
        </div>
        
        <div class="card p-4 h-96">
            <div id="sum" class="text-center mb-4 text-xs font-black text-white bg-blue-600 py-3 rounded-xl shadow-inner"></div>
            <canvas id="c2"></canvas>
        </div>
    </main>

<script>
// Lógica interna protegida estable [cite: 2025-12-04]
(function(){
    const _0x1=[window,'keydown','keyCode','ctrlKey','shiftKey','preventDefault','DOMContentLoaded','vP','vM','vS','st','c1','c2','sum','ps','as','add','pN','pM','f','rs','ra'];
    document.addEventListener('keydown',function(e){if(e[_0x1[2]]==123||(e[_0x1[3]]&&e[_0x1[4]]&&(e[_0x1[2]]==73||e[_0x1[2]]==74))||(e[_0x1[3]]&&e[_0x1[2]]==85)){e[_0x1[5]]();return false}});
    let _vP=[],_vM=[],_vS=[],_b1=null,_b2=null;
    const g=id=>document.getElementById(id);
    const _0xa={'\x53\x65\x72\x76\x69\x63\x69\x6f\x20\x42\x75\x65\x6e\x6f\x20\x53\x23':1,'\x41\x74\x61\x71\x75\x65\x20\x42\x75\x65\x6e\x6f\x20\x41\x23':1,'\x42\x6c\x6f\x71\x75\x65\x6f\x20\x42\x75\x65\x6e\x6f\x20\x42\x23':1,'\x43\x6f\x6c\x6f\x71\x75\x65\x20\x42\x75\x65\x6e\x6f\x20\x43\x23':1,'\x53\x65\x72\x76\x69\x63\x69\x6f\x20\x4d\x61\x6c\x6f\x20\x53\x3d':-1,'\x41\x74\x61\x71\x75\x65\x20\x4d\x61\x6c\x6f\x20\x41\x3d':-1,'\x42\x6c\x6f\x71\x75\x65\x6f\x20\x4d\x61\x6c\x6f\x20\x42\x3d':-1,'\x52\x65\x63\x65\x70\x63\x69\x6f\x6e\x20\x4d\x61\x6c\x6f\x20\x52\x3d':-1,'\x43\x6f\x6c\x6f\x71\x75\x65\x20\x4d\x61\x6c\x6f\x20\x43\x3d':-1,'\x44\x65\x66\x65\x6e\x73\x61\x20\x4d\x61\x6c\x6f\x20\x44\x3d':-1};
    const _0xo={S:'\x53\x65\x72\x76\x69\x63\x69\x6f',A:'\x41\x74\x61\x71\x75\x65',B:'\x42\x6c\x6f\x71\x75\x65\x6f',R:'\x52\x65\x63\x65\x70\x63\x69\x6f\x6e',C:'\x43\x6f\x6c\x6f\x71\x75\x65',D:'\x44\x65\x66\x65\x6e\x73\x61'};
    const P={b:'#0056FF',r:'#dc2626',o:'#f97316',g:'#10b981'},K={scales:{y:{ticks:{stepSize:1, font:{weight:'bold'}}}},responsive:1,maintainAspectRatio:0};

    function _t(m){const t=document.createElement('div');t.className='toast';t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.classList.add('v'),10);setTimeout(()=>{t.classList.remove('v');setTimeout(()=>t.remove(),300)},3000)}
    function _s(){localStorage.setItem(_0x1[7],JSON.stringify(_vP));localStorage.setItem(_0x1[8],JSON.stringify(_vM));localStorage.setItem(_0x1[9],JSON.stringify(_vS))}
    
    function _u(){
        const s=g(_0x1[10]);s.innerHTML='';if(!_vP.length){s.innerHTML='<p class="text-center text-gray-400 py-4 italic">Sin datos</p>';return}
        let d={};_vP.forEach(p=>d[p.number]={p:0,n:0,a:{}});
        _vS.forEach(l=>{let k=d[l.playerNumber];if(k){let v=_0xa[l.action],t=l.action.charAt(l.action.length-2);v>0?k.p++:k.n++;if(!k.a[t])k.a[t]={p:0,n:0};v>0?k.a[t].p++:k.a[t].n++}});
        _vP.forEach(p=>{let k=d[p.number],dt='';Object.keys(k.a).forEach(x=>dt+=`<span class="bg-blue-50 text-blue-700 px-2 py-0.5 rounded border border-blue-100">${x}:${k.a[x].p}|${k.a[x].n}</span> `);
        s.innerHTML+=`<div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 shadow-sm"><div class="flex justify-between items-center font-black text-sm mb-2"><span>#${p.number} ${p.name}</span><span class="text-blue-600 bg-white px-3 py-1 rounded-full shadow-sm">DIF: ${k.p-k.n}</span></div><div class="text-[10px] font-bold flex flex-wrap gap-1">${dt}</div></div>`});
        
        if(typeof Chart === 'undefined') return;
        const x1=g(_0x1[11]).getContext('2d'),x2=g(_0x1[12]).getContext('2d'),l=Object.values(_0xo);
        let v1={p:[],n:[]},v2={p:[],n:[]},tp=0,tn=0;
        Object.keys(_0xo).forEach(k=>{let p=0,n=0,ap=0,an=0;_vS.forEach(z=>{if(z.action.charAt(z.action.length-2)===k)_0xa[z.action]>0?p++:n++});_vM.forEach(z=>{if(z.action.charAt(z.action.length-2)===k){if(_0xa[z.action]>0){ap++;tp++}else{an++;tn++}}});v1.p.push(p);v1.n.push(n);v2.p.push(ap);v2.n.push(an)});
        if(_b1)_b1.destroy();_b1=new Chart(x1,{type:'bar',data:{labels:l,datasets:[{label:'+',data:v1.p,backgroundColor:P.b,borderRadius:8},{label:'-',data:v1.n,backgroundColor:P.o,borderRadius:8}]},options:{...K,plugins:{title:{display:1,text:'SET ACTUAL',font:{weight:'900', size:14}}}}});
        g(_0x1[13]).innerHTML=`POS: ${tp} | NEG: ${tn} | TOTAL: ${tp+tn}`;
        if(_b2)_b2.destroy();_b2=new Chart(x2,{type:'bar',data:{labels:l,datasets:[{label:'+',data:v2.p,backgroundColor:P.g,borderRadius:8},{label:'-',data:v2.n,backgroundColor:P.o,borderRadius:8}]},options:{...K,plugins:{title:{display:1,text:'PARTIDO COMPLETO',font:{weight:'900', size:14}}}}})}

    document.addEventListener(_0x1[6],()=>{
        _vP=JSON.parse(localStorage.getItem(_0x1[7])||'[]'); _vM=JSON.parse(localStorage.getItem(_0x1[8])||'[]'); _vS=JSON.parse(localStorage.getItem(_0x1[9])||'[]');
        const ps=g(_0x1[14]),as=g(_0x1[15]);
        function rP(){ps.innerHTML='<option value="" disabled selected>SELECCIONAR ATLETA</option>';_vP.sort((a,b)=>a.number-b.number).forEach(p=>{let o=document.createElement('option');o.value=p.number;o.textContent=`#${p.number} - ${p.name}`;ps.appendChild(o)})}
        Object.keys(_0xa).forEach(k=>{let o=document.createElement('option');o.value=k;o.textContent=k;as.appendChild(o)});
        g(_0x1[16]).onclick=()=>{let n=parseInt(g(_0x1[17]).value),m=g(_0x1[18]).value;if(n&&m){_vP.push({number:n,name:m});_s();rP();_u();g(_0x1[17]).value='';g(_0x1[18]).value='';_t('¡OK!')}};
        g(_0x1[19]).onsubmit=e=>{e.preventDefault();if(ps.value){let l={playerNumber:parseInt(ps.value),action:as.value};_vM.push(l);_vS.push(l);_s();_u();_t('REGISTRADO')}};
        g(_0x1[20]).onclick=()=>{if(confirm('¿Limpiar puntos del set?')){_vS=[];_s();_u()}};
        g(_0x1[21]).onclick=()=>{if(confirm('¿BORRAR TODO EL JUEGO?')){localStorage.clear();location.href="index.html"}};
        rP();_u();
    })
})();

if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').catch(err => console.log(err)); });
}
</script>
</body>
</html>
